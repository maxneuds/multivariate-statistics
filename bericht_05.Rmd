---
output: pdf_document
header-includes: 
- \usepackage[utf8]{inputenc}
- \usepackage[T1]{fontenc}
- \usepackage[ngerman]{babel}
- \usepackage{amsmath,amssymb,amsthm}
- \usepackage{dsfont}
- \usepackage{listings}
- \usepackage{floatrow}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- '\fancyhead[C,C]{Robin Baudisch, Merlin Kopfmann, Maximilian Neudert}'
- \fancyhead[L]{}
- \fancyhead[R]{}
- \fancyfoot[C,C]{\thepage}
- \renewcommand{\footrulewidth}{0.4pt}
---

<style type="text/css">
body{
  font-size: 12px;
}
h1 {
  font-size: 18px;
}
h1 {
  font-size: 14px;
}
h1 {
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(error=TRUE,     # Keep compiling upon error
                      collapse=TRUE,  # collapse by default
                      echo=TRUE,      # echo code by default
                      comment = "#>", # change comment character
                      warning=TRUE,   # show R warnings
                      message=FALSE,  # show R messages
                      out.width = "100%",
                      out.height = "100%",
                      fig.width = 10)
```

<!---** Hochschule Darmstadt | Studiengang Data Science | Sommersemester 2019 **--->

set.seed(42)

# Aufgabe 2)
```{r}
library("ISLR")

model_mpg <- lm(Auto$mpg~Auto$horsepower+Auto$year+Auto$origin)
plot(model_mpg)
```

```{r}
model_log_mpg <- lm(log(Auto$mpg)~Auto$horsepower+Auto$year+Auto$origin)
plot(model_log_mpg)
```

## a)

Wenn wir uns die Grafik "Residuals vs Fitted" ansehen, sehen wir, dass die Daten kein offensichtliches, eindeutiges Muster haben. Obwohl die Kurven leicht gewölbt sind, haben sie gleichmäßige Residuen um die horizontale Linie herum verteilt, ohne ein ausgeprägtes Muster.
Dies ist ein guter Hinweis darauf, dass es sich nicht um eine nichtlineare Beziehung handelt.

Die Residuen sollten normalverteilt sein, und der Q-Q Plot ist ein gutes Instrument, um dies zu überprüfen. Für beide Modelle zeigt der Q-Q-Plot eine ziemlich gute Anpassung auf die Linie. Nach oben hin weichen die Punkte für das mpg-Modell deutlicher von der Linie ab, als im log(mpg)-Modell. 

Die "Scale-Location"-Plots testen die lineare Regressionsannahme der gleichen Varianz (Homoscedastizität), d.h. dass die Residuen die gleiche Varianz entlang der Regressionslinie aufweisen.

In unseren beiden Modellen sind die Residuen relativ gut über und unter einer ziemlich horizontalen Linie verteilt.

Die "Residuals vs Leverage"-Plots können verwendet werden, um einflussreiche Datenpunkte im Datensatz zu finden. Ein einflussreicher Datenpunkt ist einer, der, wenn er entfernt wird, das Modell beeinflusst, so dass seine Einbeziehung oder sein Ausschluss in Betracht gezogen werden sollte.

Ein einflussreicher Datenpunkt kann ein Ausreißer sein oder auch nicht, und der Zweck dieser Grafik ist es, Fälle zu identifizieren, die einen hohen Einfluss auf das Modell haben. Ausreißer neigen dazu, Leverage und damit Einfluss auf das Modell auszuüben.

Ein einflussreicher Fall erscheint oben rechts oder unten links in der Grafik innerhalb einer roten Linie, die Cook's Distance markiert. 

In beiden Modellen gibt es keine offensichtlichen Ausreißer (laut Cook's Distance).

Abschließend würden wir das log(mpg)-Modell bevorzugen, obwohl es kaum Unterschiede in den Residuen gibt. Alleine der Q-Q-Plot des log(mpg)-Modells deutet auf eine bessere Anpassung der Residuen auf die Normalverteilung hin als im mpg-Modell.

## b)

Der Punkt 116 ist in beiden Modellen des Öfteren markiert. Schauen wir uns diesen näher an:

```{r}
pt_116 <- Auto[116,]
summary <- summary(Auto)
c(pt_116)
summary
```

Hier wird deutlich, dass der Punkt 116 ein Extremfall in unserem Datensatz ist.

## c)

```{r}
library(leaps)
regfit.full = regsubsets(log(Auto$mpg)~Auto$cylinders+Auto$displacement+Auto$horsepower+Auto$weight+Auto$acceleration+Auto$year+Auto$origin, data=Auto)
reg.summary = summary(regfit.full)
```

```{r}
plot(reg.summary$bic, xlab="Number of Variables", ylab="BIC", type="l") 
plot(reg.summary$cp, xlab="Number of Variables", ylab="AIC", type="l")
plot(reg.summary$adjr2, xlab="Number of Variables", ylab="Adjusted RSq", type="l")
```
Wir würden uns für ein Modell mit 4 Kovariaten entscheiden, da dort BIC und AIC sehr klein sind und $R^2$ groß ist. 

```{r}
coef(regfit.full, 4)
```