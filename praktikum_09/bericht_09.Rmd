---
output: pdf_document
header-includes: 
- \usepackage[utf8]{inputenc}
- \usepackage[T1]{fontenc}
- \usepackage[ngerman]{babel}
- \usepackage{amsmath,amssymb,amsthm}
- \usepackage{dsfont}
- \usepackage{listings}
- \usepackage{floatrow}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- '\fancyhead[C,C]{Gruppe 11: Robin Baudisch, Merlin Kopfmann, Maximilian Neudert}'
- \fancyhead[L]{}
- \fancyhead[R]{}
- \fancyfoot[C,C]{\thepage}
- \renewcommand{\footrulewidth}{0.4pt}
- '\newcommand{\cov}[1]{\operatorname{Cov}\left( #1 \right)}'
- '\newcommand{\cor}[1]{\operatorname{Cor}\left( #1 \right)}'
- '\newcommand{\V}[1]{\mathbf{\operatorname{V}}\left( #1 \right)}'
- '\newcommand{\E}[1]{\mathbf{\operatorname{E}}\left( #1 \right)}'
---

<style type="text/css">
body{
  font-size: 12px;
}
h1 {
  font-size: 18px;
}
h1 {
  font-size: 14px;
}
h1 {
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(error=TRUE,     # Keep compiling upon error
                      collapse=TRUE,  # collapse by default
                      echo=TRUE,      # echo code by default
                      comment = "#>", # change comment character
                      warning=TRUE,   # show R warnings
                      message=FALSE,  # show R messages
                      out.width = "100%",
                      out.height = "100%",
                      fig.width = 10)

packageTest<- function(x)  {
    if (!require(x,character.only = TRUE))  {
      install.packages(x,dep=TRUE)
      if(!require(x,character.only = TRUE)) stop("Package not found")
    }
}
```

<!---** Hochschule Darmstadt | Studiengang Data Science | Sommersemester 2019 **--->

```{r}
set.seed(42)
```

# Arbeitsblatt 9

## Aufgabe 1


## Aufgabe 2

```{r}
load("diab.RData")

log_reg <- glm(diabetes~pgc+bmi, family=binomial(link='logit'), data=diab)

pred = predict.glm(log_reg, data.frame(pgc=120, bmi=27), type="response")[1]
pred = as.vector(pred)

logit = function(L) {
  return(1/2*(1+tanh(L/2)))
}

pred2 = as.vector(logit(log_reg$coefficients[1]+log_reg$coefficients[2]*120+log_reg$coefficients[3]*27))
delta = round((pred - pred2)^2, 4)
delta

pred
pred2
```

### b)
```{r}
summary(log_reg)
```

Die Koeffizientenschätzung der Variablen pgc ist $\beta$ = `r log_reg$coefficients[2]`, ein positiver Wert. Dies bedeutet, dass ein Anstieg der Glukosekonzentration mit einer Erhöhung der Wahrscheinlichkeit verbunden ist, an Diabetes erkrankt zu sein.

### c)
Ein wichtiges zu verstehendes Konzept für die Interpretation der logistischen Beta-Koeffizienten ist die Odds Ratio. Die Odds Ratio misst die Zuordnung zwischen einer Prädiktorvariablen (x) und der Ergebnisvariablen (y). Es stellt das Verhältnis der Chancen dar, dass ein Ereignis eintritt (Ereignis = 1) bei Vorhandensein des Prädiktors x (x = 1), verglichen mit den Chancen des Ereignisses, das in Abwesenheit dieses Prädiktors eintritt (x = 0).

Für einen gegebenen Prädiktor (z.B. x1) entspricht der zugehörige Beta-Koeffizient (b1) in der logistischen Regressionsfunktion dem Logarithmus der Odds Ratios für diesen Prädiktor.

Wenn die Odds Ratio 2 ist, dann sind die Chancen, dass das Ereignis eintritt (Ereignis = 1), doppelt so hoch, wenn der Prädiktor x vorhanden ist (x = 1) als für ein Fehlen des Prädiktors (x = 0).

So beträgt beispielsweise der Regressionskoeffizient für BMI `r log_reg$coefficients[3]`. Dies deutet darauf hin, dass eine Erhöhung des BMI um 5 Einheiten die Wahrscheinlichkeit, an Diabetes erkrankt zu sein, um das `r 5/exp(log_reg$coefficients[3])`-fache erhöht $\left(\frac{5}{exp(\beta_{bmi})}\right)$.


### d)
```{r}
packageTest("pROC")

plot.roc(diab$diabetes, diab$pgc+diab$bmi)
```

### e)

```{r}
test <- NULL
test$y.true <- diab$diabetes
test$y.pred <- predict.glm(log_reg, type="response")

test$y.pred[test$y.pred > 0.5] = 1
test$y.pred[test$y.pred <= 0.5] = 0

confusion_matrix <- table(test)
confusion_matrix

misclass_rate <- 1-sum(diag(confusion_matrix))/sum(confusion_matrix)

sensitivity <- confusion_matrix[2,2]/(confusion_matrix[2,2] + confusion_matrix[2,2])

specificity <- confusion_matrix[1,1]/(confusion_matrix[1,1] + confusion_matrix[1,2])

misclass_rate
sensitivity
specificity

plot.roc(diab$diabetes, diab$pgc+diab$bmi)
points(specificity, sensitivity, col="red", pch = 16)
```
## Aufgabe 3