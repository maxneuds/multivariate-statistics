---
output: pdf_document
header-includes: 
- \usepackage[utf8]{inputenc}
- \usepackage[T1]{fontenc}
- \usepackage[ngerman]{babel}
- \usepackage{amsmath,amssymb,amsthm}
- \usepackage{dsfont}
- \usepackage{listings}
- \usepackage{floatrow}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- '\fancyhead[C,C]{Gruppe 11: Robin Baudisch, Merlin Kopfmann, Maximilian Neudert}'
- \fancyhead[L]{}
- \fancyhead[R]{}
- \fancyfoot[C,C]{\thepage}
- \renewcommand{\footrulewidth}{0.4pt}
- '\newcommand{\cov}[1]{\operatorname{Cov}\left( #1 \right)}'
- '\newcommand{\cor}[1]{\operatorname{Cor}\left( #1 \right)}'
- '\newcommand{\V}[1]{\mathbf{\operatorname{V}}\left( #1 \right)}'
- '\newcommand{\E}[1]{\mathbf{\operatorname{E}}\left( #1 \right)}'
---

<style type="text/css">
body{
  font-size: 12px;
}
h1 {
  font-size: 18px;
}
h1 {
  font-size: 14px;
}
h1 {
  font-size: 12px;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(error=TRUE,     # Keep compiling upon error
                      collapse=TRUE,  # collapse by default
                      echo=TRUE,      # echo code by default
                      comment = "#>", # change comment character
                      warning=TRUE,   # show R warnings
                      message=FALSE,  # show R messages
                      out.width = "100%",
                      out.height = "100%",
                      fig.width = 10)
```

<!---** Hochschule Darmstadt | Studiengang Data Science | Sommersemester 2019 **--->

```{r}
set.seed(42)
```

# Arbeitsblatt 6

## Aufgabe 1

### a)
```{r}
load("prostate.RData")

hist(prostate$age)
hist(prostate$svi)
hist(prostate$gleason)
hist(prostate$pgg45)
hist(prostate$psa)
hist(prostate$cavol)


prostate$pgg45log <- log(prostate$pgg45)
prostate$pgg45log[is.infinite(prostate$pgg45log)] <- -exp(99)
prostate$cavollog <- log(prostate$cavol)
prostate$cavollog[is.infinite(prostate$cavollog)] <- -exp(99)

linreg_log <- lm(log(psa) ~ age+svi+log(gleason)+pgg45log+cavollog, data = prostate)
linreg <- lm(psa ~ age+svi+gleason+pgg45+cavol, data = prostate)
summary(linreg_log)
summary(linreg)
AIC(linreg_log, linreg, linreg_log2)
```

Das Modell mit logarithmierten Kovariaten gleason, pgg45 und cavol und abhängiger Variable log(psa) ist deutlich besser als das Modell ohne Variablentransformation. Dies lässt sich zum einen am R^2-Wert ablesen, als auch über den AIC-Vergleich feststellen. 

### b)
```{r}
library("MASS")
library("leaps")
stepAIC(linreg_log, direction = "backward")
linreg_forward <- lm(log(psa) ~ 1, data = prostate)
stepAIC(linreg_forward, direction = "forward", scope=list(upper=linreg_log,lower=linreg_forward))

regfit.full <- regsubsets(log(psa) ~ age+svi+log(gleason)+pgg45log+cavollog, data = prostate)
reg.summary <- summary(regfit.full)
plot(reg.summary$rsq)
```

## Aufgabe 2

Wir kÃ¶nnen die Unkorreliertheit einerseits beweisen durch

\begin{align}
\cov{Y_i, Y_j}
& = \cov{(A^T X)_i, (A^T X)_j} \\
& = \cov{A^T X}_{ij} \\
& = \left( A^T \cov{X} A \right)_{ij} \\
& = \left( A^T \Sigma A \right)_{ij} \\
& = \Lambda_{ij} \\
& = \begin{cases}
1, & i = j,\\
0, & \text{sonst}.
\end{cases}
\end{align}

Alternativ zur besseren Vorstellung.
Sei $e_i$ der $i$-te Einheitsvektor, dann erhalten wir:

\begin{align}
\cov{Y_i, Y_j}
& = \cov{(A^T X)_i, (A^T X)_j} \\
& = \cov{e_i^T A^T X, e_j^T A^T X} \\
& = e_i^T \cov{A^T X, A^T X} e_j \\
& = e_i^T A^T \cov{X, X} A e_j \\
& = e_i^T A^T \Sigma A e_j \\
& = e_i^T \Lambda e_j \\
& = \Lambda_i e_j \\
& = \Lambda_{ij}
& = \begin{cases}
1, & i = j,\\
0, & \text{sonst}.
\end{cases}
\end{align}














